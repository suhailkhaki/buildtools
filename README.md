Preamble
--------

Please see http://hub.internal.couchbase.com/confluence/display/cbeng/Building+Couchbase+Server+2.x

Overview
---------
Voltron20 is a utility to build a software from its binaries. It manages a software depot (repository) that stores all the dependancies required to build a software. 
Voltron20 workflow has three stages

1. Staging : The dependency package is installed manually in a staging area following the standard installations steps defined for that package installation. Initial manifest file can also be generated by using manifest utility provided by voltron20.

2. Deployment : Based on the manifest file, the package is deployed in the software depot.

3. Installation: Package is installed as per configuration provided in manifest file for that given package. Any dependency defined in the manifest file is installed recursively.

<i>The stage 1 and 2 are the part of the process to populate the software depot with the dependency packages. The stage 3 is the actual installation on the user system.</i>

Manifest file Structure
------------------------

	{   
	   "dirs": [
	     {
	       "path": "relative path of internal directory structure of package"
	     } 
	    ],
	   
	   "files" :[
	     {
	       "path" : "The relative pathname to the file to install",
	       "sha1" : "The sha1 of the file",
	       "mode" : "The file mode"
	     }
	   ],
	   
	   "depends":[
	     {
	       "package": "name of the dependent package",
	       "version": "version of the dependent package we want",
	       "platform": "target installation platform of dependent package",
	       "manifest": "manifest file name for the dependent package as defined in software depot. \n
			    If we provide the this attribute then other attributes are optional"
	     }
	   ]
	    
	   "build":[
	     { "command": "command to install package to staging area.",
	       "ordinal": "sequence number in which command is executed",
	       "note": "Any notes and remarks"
	     }
	  ]
	}

Notes
------
For the command structure please refer below image.

The commands maked with tick are currently implemented ones.

![Commands](https://raw.github.com/suhailkhaki/buildtools/master/CommandAPI.png "Command API Structure")

Example 1 - Snappy
------------------
This examples assumes following directory structure

	Staging Directory : /tmp
	Software Depot: /cbdepot
	Install Directory: /cbinstall

In this example, 
* Staging -> Step 1,2 and 3
* Deployment -> Step 4
* Installation -> Step 5

1. Download Snappy and extract it:

		wget http://snappy.googlecode.com/files/snappy-1.0.5.tar.gz
		tar -xvf snappy-1.0.5.tar.gz
		cd snappy-1.0.5/

2. Compile Snappy:
		
		./configure --prefix=/opt/couchbase
		gmake install DESTDIR=/tmp/snappy

3. Generate manifest file:
	  
		python voltron20.py manifest genfile --package_name="snappy" -ver="1.0.5" -p="ubuntu-12.04" 
		-sd="/tmp/snappy/opt/couchbase" -tfp="/tmp"
	

4. Deploy the binaries to our software depot:

		python voltron20.py depot -l="/cbdepot" add --package_name="snappy" -ver="1.0.5" 
		-p="ubuntu-12.04" -sd="/tmp/snappy/opt/couchbase" -md="/tmp"

5. Install it to the directory named install:

		install --package_name="snappy" -ver="1.0.5" -p="ubuntu-12.04" 
		-d="/cbinstall" -depol="/cbdepot"

